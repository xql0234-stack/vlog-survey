import streamlit as st
import pandas as pd
import random
from datetime import datetime
import os

# -----------------------------
# é é¢è¨­å®š
# -----------------------------
st.set_page_config(page_title="æ—…éŠVlogå•å·æ¸¬é©—", layout="centered")

st.title("ğŸ¬ æ—…éŠ Vlog å…§å®¹é¢¨æ ¼èˆ‡ç”Ÿæ´»å‹æ…‹å•å·")

# -----------------------------
# å•å·èªªæ˜
# -----------------------------
st.markdown("""
æ‚¨å¥½ï¼š

æ„Ÿè¬æ‚¨æ’¥å†—å¡«å¯«æœ¬å•å·ã€‚æœ¬ç ”ç©¶æ—¨åœ¨æ¢è¨ä¸åŒç”Ÿæ´»å‹æ…‹çš„è§€çœ¾ï¼Œ
å°æ—…éŠ Vlog å½±ç‰‡å…§å®¹å½¢å¼åŠ YouTuber å€‹äººç‰¹è³ªçš„åå¥½å·®ç•°ã€‚

æœ¬å•å·æ¡åŒ¿åå¡«ç­”æ–¹å¼ï¼Œæ‰€æœ‰è³‡æ–™åƒ…ä¾›å­¸è¡“ç ”ç©¶ä½¿ç”¨ï¼Œ
ä¸æ¶‰åŠä»»ä½•å•†æ¥­ç”¨é€”ã€‚è«‹æ‚¨ä¾å€‹äººçœŸå¯¦æƒ³æ³•ä½œç­”ï¼Œ
å…§å®¹ç„¡å°éŒ¯ä¹‹åˆ†ï¼Œæ•¬è«‹æ”¾å¿ƒå¡«å¯«ã€‚

å¡«ç­”æµç¨‹åŒ…å«ç”Ÿæ´»å‹æ…‹æ¸¬é©—èˆ‡å½±ç‰‡è§€è³ï¼Œ
ç³»çµ±å°‡åˆ†é…å…©æ”¯æ—…éŠ Vlog å½±ç‰‡ï¼Œè«‹æ‚¨è§€çœ‹å¾Œä¾é¡Œé …ä½œç­”å³å¯ã€‚

è‹¥æ‚¨å°æœ¬ç ”ç©¶æœ‰ä»»ä½•ç–‘å•ï¼Œæ­¡è¿èˆ‡ç ”ç©¶è€…è¯ç¹«ï¼š  
ä¸­åœ‹æ–‡åŒ–å¤§å­¸æ–°èå­¸ç³»ç ”ç©¶ç”Ÿ **è¨±ç§‹ç³**  
ğŸ“§ é›»å­éƒµä»¶ï¼š**xql0234@gmail.com**

å†æ¬¡æ„Ÿè¬æ‚¨çš„å”åŠ©ï¼
""")

st.write("---")  # åˆ†éš”ç·š

st.write("è«‹æ ¹æ“šæ‚¨çš„æƒ³æ³•å›ç­”ä»¥ä¸‹é¡Œç›®ï¼Œ1 è¡¨ç¤ºã€éå¸¸ä¸åŒæ„ã€ï¼Œ7 è¡¨ç¤ºã€éå¸¸åŒæ„ã€ã€‚")

# -----------------------------
# ç¬¬ä¸€éƒ¨åˆ†ï¼šåŸºæœ¬è³‡æ–™
# -----------------------------
st.header("ç¬¬ä¸€éƒ¨åˆ†ï¼šåŸºæœ¬è³‡æ–™")

watch_vlog = st.radio("1. éå»ä¸€å€‹æœˆæ˜¯å¦çœ‹éã€Œæ—…éŠç›¸é—œã€YouTubeå½±ç‰‡ï¼Ÿ", ["æ˜¯", "å¦"])
if watch_vlog == "å¦":
    st.info("æ„Ÿè¬æ‚¨çš„åƒèˆ‡ï¼Œæœ¬å•å·åˆ°æ­¤çµæŸ ğŸ™")
    st.stop()

watch_freq = st.radio("2. æ‚¨æ¯å‘¨å¹³å‡è§€çœ‹æ—…éŠVlogæ¬¡æ•¸ç‚ºï¼š", ["1~3æ¬¡", "4~6æ¬¡", "7~9æ¬¡", "10æ¬¡ä»¥ä¸Š"])
watch_time = st.radio("3. æ‚¨æ¯æ¬¡å¹³å‡è§€çœ‹æ—…éŠVlogæ‰€èŠ±è²»çš„æ™‚é–“ç‚ºï¼š", ["15åˆ†é˜ä»¥ä¸‹", "15~30åˆ†é˜", "30~45åˆ†é˜", "45åˆ†é˜ä»¥ä¸Š"])
gender = st.radio("4. æ‚¨çš„ç”Ÿç†æ€§åˆ¥ï¼š", ["ç”·", "å¥³"])
age_group = st.radio("5. æ‚¨çš„å¹´é½¡ï¼š", ["15~19æ­²", "20~29æ­²", "30~39æ­²", "40~49æ­²", "50~59æ­²", "60æ­²ä»¥ä¸Š"])
edu = st.radio("6. æ‚¨ç¾éšæ®µæœ€é«˜çš„æ•™è‚²ç¨‹åº¦ï¼š", ["åœ‹ä¸­(å«)ä»¥ä¸‹", "é«˜ä¸­(è·)", "å¤§å­¸(å°ˆ)", "ç ”ç©¶æ‰€(å«)ä»¥ä¸Š"])
job = st.selectbox("7. æ‚¨çš„è·æ¥­ï¼š", [
    "è¾²æ—æ¼ç‰§ç¤¦æ¥­", "è£½é€ æ¥­", "æœå‹™æ¥­", "è‡ªç”±æ¥­", "å•†æ¥­", "é›»å­è³‡è¨Šå·¥ç¨‹æ¥­", "å°ˆæ¥­äººå“¡(æ³•å¾‹ã€é†«ç™‚ã€è—è¡“è¡¨æ¼”ç­‰)",
    "è»ã€è­¦ã€å…¬ã€æ•™", "å®¶ç®¡", "å­¸ç”Ÿ", "é€€ä¼‘/å¾…æ¥­ä¸­/ç„¡æ¥­", "å…¶ä»–"
])
income = st.selectbox("8. æ‚¨çš„æ¯æœˆå¯æ”¯é…æ‰€å¾—ï¼š", [
    "20,000å…ƒä»¥ä¸‹", "20,001~40,000å…ƒ", "40,001~60,000å…ƒ", "60,001~80,000å…ƒ",
    "80,001~100,000å…ƒ", "100,001~120,000å…ƒ", "120,001~140,000å…ƒ", "140,001~160,000å…ƒ",
    "160,001~180,000å…ƒ", "180,001~200,000å…ƒ", "200,001å…ƒä»¥ä¸Š"
])

# -----------------------------
# ç¬¬äºŒéƒ¨åˆ†ï¼šç”Ÿæ´»å‹æ…‹
# -----------------------------
st.header("ç¬¬äºŒéƒ¨åˆ†ï¼šç”Ÿæ´»å‹æ…‹")

questions = {
    "æ¢ç´¢å†’éšªå‹": [
        "æˆ‘å–œæ­¡å˜—è©¦æ–°åœ°æ–¹èˆ‡ä¸ç†Ÿæ‚‰çš„æ´»å‹•ã€‚",
        "æˆ‘æœƒæœŸå¾…ç”Ÿæ´»ä¸­æœ‰äº›é©šå–œã€‚",
        "æˆ‘ä¸å–œæ­¡å¤ªæœ‰è¦å¾‹çš„ç”Ÿæ´»ã€‚",
        "æˆ‘äº«å—å…·æŒ‘æˆ°æ€§çš„æ—…éŠé«”é©—ã€‚"
    ],
    "ç¤¾äº¤åˆ†äº«å‹": [
        "æˆ‘å–œæ­¡åœ¨ç¤¾ç¾¤åª’é«”ä¸Šåˆ†äº«æˆ‘çš„æ—…éŠç¶“é©—æˆ–ç…§ç‰‡ã€‚",
        "æˆ‘æœƒé€éç¤¾ç¾¤å¹³å°è¿½è¹¤æ—…éŠYouTuberã€‚",
        "æˆ‘åƒåŠ æ—…éŠæ´»å‹•æ˜¯ç‚ºäº†è¯çµ¡é„°å±…æˆ–æœ‹å‹ä¹‹é–“çš„æ„Ÿæƒ…ã€‚",
        "æˆ‘å¸¸èˆ‡æœ‹å‹è¨è«–æ—…éŠ Vlog çš„å…§å®¹ï¼Œæˆ–äº¤æ›æ—…éŠè³‡è¨Šã€‚"
    ],
    "ä¼‘é–’æ”¾é¬†å‹": [
        "æˆ‘å¹³å¸¸å–œæ­¡å’Œæœ‹å‹ä¸€èµ·åˆ°æˆ¶å¤–æ‰“çƒã€é€›è¡—æˆ–æ˜¯åˆ°éƒŠå¤–è¸é’ã€‚",
        "æˆ‘ç¶“å¸¸å®‰æ’å…©ã€ä¸‰å¤©ä»¥ä¸Šçš„æ—…éŠã€‚",
        "æ—…éŠæ˜¯æˆ‘æœ€å–œæ­¡çš„ä¼‘é–’æ´»å‹•ã€‚",
        "æˆ‘çœ‹æ—…éŠVlogå¤šåŠç‚ºäº†ç´“å£“ã€‚"
    ],
    "ç†æ€§è¦åŠƒå‹": [
        "æˆ‘ç¿’æ…£æ¯”è¼ƒåƒ¹æ ¼ã€è©•ä¼°æ€§åƒ¹æ¯”å¾Œå†æ±ºå®šã€‚",
        "æˆ‘æœƒåšå®Œæ•´è¡Œå‰åŠŸèª²èˆ‡æ™‚é–“è¦ç•«ã€‚",
        "æˆ‘åœ¨æ—…è¡Œæ™‚è¼ƒå°‘ä¾é éš¨èˆˆæˆ–è‡¨æ™‚æ±ºå®šã€‚",
        "æˆ‘æœƒå®šæœŸæœå°‹æ—…éŠç›¸é—œè³‡è¨Šã€‚"
    ]
}

# è‡ªå‹•åŠ ä¸Šé¡Œè™Ÿï¼ˆæ”¹ç‚º 1ï½7é‡è¡¨ï¼‰
responses = {}
question_num = 1
for category, qs in questions.items():
    for q in qs:
        question_label = f"{question_num}. {q}"
        responses[q] = st.slider(question_label, 1, 7, 4, key=q)
        question_num += 1

# -----------------------------
# å½±ç‰‡é€£çµ
# -----------------------------
videos = {
    "æ¢ç´¢å†’éšªå‹": "https://www.youtube.com/watch?v=rn3vkZf1NEw&list=PLaTgGdKCl5EgUqoegkfpAAqW0U3VtIaor&index=4",
    "ç¤¾äº¤åˆ†äº«å‹": "https://www.youtube.com/watch?v=H_OVtdOKu8g&list=PLaTgGdKCl5EgUqoegkfpAAqW0U3VtIaor&index=2",
    "ä¼‘é–’æ”¾é¬†å‹": "https://www.youtube.com/watch?v=oMnOt9v3YSw&list=PLaTgGdKCl5EgUqoegkfpAAqW0U3VtIaor&index=3",
    "ç†æ€§è¦åŠƒå‹": "https://www.youtube.com/watch?v=LpFSGtGw4X8&list=PLaTgGdKCl5EgUqoegkfpAAqW0U3VtIaor"
}

# -----------------------------
# æäº¤èˆ‡çµæœè¨ˆç®—
# -----------------------------
if st.button("æäº¤å•å·"):
    category_scores = {cat: sum(responses[q] for q in qs) for cat, qs in questions.items()}
    lifestyle = max(category_scores, key=category_scores.get)

    st.success(f"ä½ çš„ç”Ÿæ´»å‹æ…‹ç‚ºï¼š**{lifestyle}** ğŸ‰")

    matched_video = videos[lifestyle]
    other_videos = [v for k, v in videos.items() if k != lifestyle]
    random_video = random.choice(other_videos)

    st.write("ğŸ“º ä»¥ä¸‹æ˜¯ç‚ºä½ æ¨è–¦çš„å…©æ”¯å½±ç‰‡ï¼š")
    st.markdown(f"**é…å°å½±ç‰‡ï¼ˆ{lifestyle}ï¼‰**")
    st.video(matched_video)
    st.markdown("**éš¨æ©Ÿå½±ç‰‡**")
    st.video(random_video)

    # å„²å­˜çµæœ
    data = {
        "timestamp": datetime.now().strftime("%Y-%m-%d %H:%M:%S"),
        "è§€çœ‹æ—…éŠVlog": watch_vlog,
        "è§€çœ‹é »ç‡": watch_freq,
        "è§€çœ‹æ™‚é–“": watch_time,
        "æ€§åˆ¥": gender,
        "å¹´é½¡": age_group,
        "æ•™è‚²ç¨‹åº¦": edu,
        "è·æ¥­": job,
        "æœˆå¯æ”¯é…æ‰€å¾—": income,
        "ç”Ÿæ´»å‹æ…‹": lifestyle,
        "score_æ¢ç´¢å†’éšªå‹": category_scores["æ¢ç´¢å†’éšªå‹"],
        "score_ç¤¾äº¤åˆ†äº«å‹": category_scores["ç¤¾äº¤åˆ†äº«å‹"],
        "score_ä¼‘é–’æ”¾é¬†å‹": category_scores["ä¼‘é–’æ”¾é¬†å‹"],
        "score_ç†æ€§è¦åŠƒå‹": category_scores["ç†æ€§è¦åŠƒå‹"],
        "matched_video": matched_video,
        "random_video": random_video
    }

    df = pd.DataFrame([data])
    file_path = "responses.csv"
    if not os.path.exists(file_path):
        df.to_csv(file_path, index=False, encoding="utf-8-sig")
    else:
        df.to_csv(file_path, mode="a", header=False, index=False, encoding="utf-8-sig")

    st.info("âœ… å•å·çµæœå·²è¨˜éŒ„ï¼Œæ„Ÿè¬æ‚¨çš„åƒèˆ‡ï¼")
